@model Gestor.Finanzas.Models.ViewModels.TransaccionViewModel
@{
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    ViewBag.Title = "Editar Transacción";
}

<!-- ═════════ HEADER ═════════ -->
<header class="border-b border-slate-800 px-6 py-3 flex items-center justify-between gap-4">
    <div>
        <h2 class="text-white text-lg font-semibold">Editar transacción</h2>
        <p class="text-slate-400 text-xs">Modifica los datos del movimiento</p>
    </div>
    <a href="@Url.Action("Index","Transacciones")"
       class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors text-sm">
        <i class="fa-solid fa-arrow-left"></i>
        Volver
    </a>
</header>

<!-- ═════════ MAIN ═════════ -->
<main class="overflow-y-auto p-6">
    <div class="max-w-xl mx-auto">
        <div class="bg-slate-800 border border-slate-700 rounded-2xl overflow-hidden">

            <div class="bg-slate-900 px-6 py-4 border-b border-slate-700">
                <p class="text-white font-semibold text-sm">Datos de la transacción</p>
                <p class="text-slate-400 text-xs mt-0.5">Actualiza los campos que necesites</p>
            </div>

            @using (Html.BeginForm("Edit", "Transacciones", FormMethod.Post, new { @class = "p-6 space-y-5" }))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(m => m.id)

                <!-- Validation summary -->
                if (!ViewData.ModelState.IsValid)
                {
                    <div class="bg-red-900/40 border border-red-700 text-red-400 px-4 py-3 rounded-xl text-sm">
                        <i class="fa-solid fa-circle-exclamation mr-2"></i>
                        @Html.ValidationSummary(true, "", new { @class = "list-none m-0 p-0" })
                    </div>
                }

                <!-- Tipo -->
                <div>
                    <label class="block text-slate-300 text-sm font-medium mb-1.5">
                        Tipo <span class="text-red-400">*</span>
                    </label>
                    @Html.DropDownListFor(m => m.tipo_id,
                        (SelectList)ViewBag.tipo_id,
                        "— Selecciona tipo —",
                        new { @class = "w-full bg-slate-700 border border-slate-600 text-white rounded-xl px-4 py-2.5 text-sm focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500", id = "tipo_id" })
                    @Html.ValidationMessageFor(m => m.tipo_id, "", new { @class = "text-red-400 text-xs mt-1 block" })
                </div>

                <!-- Categoría (solo gastos) -->
                <div id="wrapper-categoria">
                    <label class="block text-slate-300 text-sm font-medium mb-1.5">
                        Categoría <span class="text-red-400" id="lbl-cat-required">*</span>
                    </label>
                    @Html.DropDownListFor(m => m.categoria_id,
                        (SelectList)ViewBag.categoria_id,
                        "— Sin categoría —",
                        new { @class = "w-full bg-slate-700 border border-slate-600 text-white rounded-xl px-4 py-2.5 text-sm focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500" })
                    @Html.ValidationMessageFor(m => m.categoria_id, "", new { @class = "text-red-400 text-xs mt-1 block" })
                </div>

                <!-- Monto -->
                <div>
                    <label class="block text-slate-300 text-sm font-medium mb-1.5">
                        Monto <span class="text-red-400">*</span>
                    </label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm font-semibold">$</span>
                        @Html.TextBoxFor(m => m.monto, new { @class = "w-full bg-slate-700 border border-slate-600 text-white rounded-xl pl-8 pr-4 py-2.5 text-sm focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500", placeholder = "0.00", type = "number", step = "0.01", min = "0.01" })
                    </div>
                    @Html.ValidationMessageFor(m => m.monto, "", new { @class = "text-red-400 text-xs mt-1 block" })
                </div>

                <!-- Descripción -->
                <div>
                    <label class="block text-slate-300 text-sm font-medium mb-1.5">
                        Descripción <span class="text-slate-500 text-xs font-normal">(opcional)</span>
                    </label>
                    @Html.TextBoxFor(m => m.descripcion, new { @class = "w-full bg-slate-700 border border-slate-600 text-white rounded-xl px-4 py-2.5 text-sm focus:outline-none focus:border-violet-500 focus:ring-1 focus:ring-violet-500 placeholder-slate-500", placeholder = "Ej: Supermercado, Nómina, Netflix..." })
                    @Html.ValidationMessageFor(m => m.descripcion, "", new { @class = "text-red-400 text-xs mt-1 block" })
                </div>

                <!-- Botones -->
                <div class="flex items-center gap-3 pt-2">
                    <button type="submit"
                            class="flex-1 flex items-center justify-center gap-2 bg-violet-600 hover:bg-violet-500 transition-colors text-white px-4 py-2.5 rounded-xl text-sm font-semibold">
                        <i class="fa-solid fa-floppy-disk"></i>
                        Guardar cambios
                    </button>
                    <a href="@Url.Action("Index","Transacciones")"
                       class="flex-1 flex items-center justify-center gap-2 bg-slate-700 hover:bg-slate-600 border border-slate-600 transition-colors text-slate-300 px-4 py-2.5 rounded-xl text-sm font-semibold">
                        Cancelar
                    </a>
                </div>
            }
        </div>
    </div>
</main>

@section Scripts {
    <script>
        // Ocultar/mostrar categoría según tipo
        const tipoSelect    = document.getElementById('tipo_id');
        const wrapperCat    = document.getElementById('wrapper-categoria');
        const TIPO_INGRESO  = '2';

        function toggleCategoria() {
            const esIngreso = tipoSelect.value === TIPO_INGRESO;
            wrapperCat.style.display = esIngreso ? 'none' : 'block';
        }

        tipoSelect.addEventListener('change', toggleCategoria);
        toggleCategoria(); // Ejecutar al cargar
    </script>
}
