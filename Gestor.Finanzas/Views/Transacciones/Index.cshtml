@model IEnumerable<Gestor.Finanzas.Models.Transaccione>
@{
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    ViewBag.Title = "Transacciones";

    var empty = ViewBag.EmptyState as Gestor.Finanzas.Models.ViewModels.EmptyStateViewModel;
}

<!-- ═════════ HEADER ═════════ -->
<header class="border-b border-slate-800 px-6 py-3 flex items-center justify-between gap-4">

    <!-- Título -->
    <div>
        <h2 class="text-white text-lg font-semibold">Transacciones</h2>
        <p class="text-slate-400 text-xs">Todos tus movimientos financieros</p>
    </div>

    <!-- Acciones -->
    <a href="@Url.Action("Create","Transacciones")"
       class="flex items-center gap-2 bg-violet-600 hover:bg-violet-500 transition-colors text-white px-4 py-2 rounded-xl text-sm font-semibold">
        <i class="fa-solid fa-plus"></i>
        Nueva
    </a>
</header>

<!-- ═════════ MAIN ═════════ -->
<main class="overflow-y-auto p-6">

    <!-- Success -->
    @if (TempData["Success"] != null)
    {
        <div class="bg-emerald-900/40 border border-emerald-700 text-emerald-400 px-4 py-3 rounded-xl mb-6 text-sm">
            <i class="fa-solid fa-circle-check mr-2"></i>
            @TempData["Success"]
        </div>
    }

    @{
        var emptyState = ViewBag.EmptyState as Gestor.Finanzas.Models.ViewModels.EmptyStateViewModel;
    }

    <!-- Empty State -->
    @if (emptyState != null)
    {
         @Html.Partial("_EmptyState", empty)
    }
    else
    {
        <!-- Tabla -->
        <div class="bg-slate-800 border border-slate-700 rounded-2xl overflow-hidden">

            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-slate-900 border-b border-slate-700 text-slate-400 text-xs uppercase tracking-wider">
                        <tr>
                            <th class="px-6 py-4 text-left">Fecha</th>
                            <th class="px-6 py-4 text-left">Descripción</th>
                            <th class="px-6 py-4 text-left">Categoría</th>
                            <th class="px-6 py-4 text-left">Tipo</th>
                            <th class="px-6 py-4 text-right">Monto</th>
                            <th class="px-6 py-4 text-center">Acciones</th>
                        </tr>
                    </thead>

                    <tbody class="divide-y divide-slate-700">

                        @foreach (var item in Model)
                        {
                            bool esIngreso = item.tipo_id == 2;

                            <tr class="hover:bg-slate-700/40 transition-colors">
                                <td class="px-6 py-4 text-slate-400">
                                    @item.fecha_transaccion.ToString("dd/MM/yyyy")
                                </td>

                                <td class="px-6 py-4 text-white">
                                    @(string.IsNullOrEmpty(item.descripcion) ? "Sin descripción" : item.descripcion)
                                </td>

                                <td class="px-6 py-4">
                                    @if (!esIngreso && item.Categoria != null)
                                    {
                                        <span class="bg-slate-700 text-slate-300 px-2 py-1 rounded-lg text-xs">
                                            @item.Categoria.nombre
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="text-slate-500 text-xs">—</span>
                                    }
                                </td>

                                <td class="px-6 py-4">
                                    @if (esIngreso)
                                    {
                                        <span class="flex items-center gap-1 text-emerald-400 text-xs font-semibold">
                                            <i class="fa-solid fa-arrow-down-to-line"></i>
                                            Ingreso
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="flex items-center gap-1 text-red-400 text-xs font-semibold">
                                            <i class="fa-solid fa-arrow-up-from-line"></i>
                                            Gasto
                                        </span>
                                    }
                                </td>

                                <td class="px-6 py-4 text-right font-semibold @(esIngreso ? "text-emerald-400" : "text-red-400")">
                                    @(esIngreso ? "+" : "-")$@Math.Abs(item.monto).ToString("N2")
                                </td>

                                <td class="px-6 py-4">
                                    <div class="flex items-center justify-center gap-3 text-slate-400">
                                        <a href="@Url.Action("Details", new { id = item.id })"
                                           class="hover:text-violet-400 transition-colors">
                                            <i class="fa-solid fa-eye"></i>
                                        </a>
                                        <a href="@Url.Action("Edit", new { id = item.id })"
                                           class="hover:text-yellow-400 transition-colors">
                                            <i class="fa-solid fa-pen-to-square"></i>
                                        </a>
                                        <a href="@Url.Action("Delete", new { id = item.id })"
                                           class="hover:text-red-400 transition-colors">
                                            <i class="fa-solid fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }

                    </tbody>

                    <!-- Balance -->
                    <tfoot class="bg-slate-900 border-t border-slate-700">
                        @{
                            var ingresos = Model.Where(t => t.tipo_id == 2).Sum(t => t.monto);
                            var gastos = Model.Where(t => t.tipo_id == 1).Sum(t => t.monto);
                            var balance = ingresos - gastos;
                        }
                        <tr>
                            <td colspan="4" class="px-6 py-4 text-right text-slate-400 font-semibold">
                                Balance total
                            </td>
                            <td class="px-6 py-4 text-right font-bold @(balance >= 0 ? "text-emerald-400" : "text-red-400")">
                                @(balance >= 0 ? "+" : "")$@balance.ToString("N2")
                            </td>
                            <td></td>
                        </tr>
                    </tfoot>

                </table>
            </div>
        </div>
    }

</main>